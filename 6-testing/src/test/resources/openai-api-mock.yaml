openapi: 3.0.0
info:
  title: OpenAI API
  version: "1.0"
  description: Use SCRIPT dispatcher to route based on model field

servers:
  - url: https://api.openai.com/v1

paths:
  /chat/completions:
    x-microcks-dispatcher: SCRIPT
    x-microcks-dispatcher-rules: |
      // Use Groovy to dispatch different responses based on model value
      def payload = new groovy.json.JsonSlurper().parseText(request.payload)
      return (payload.model == 'hallucinate') ? 'hallucinated_response' : 'success_response'
    post:
      summary: Chat completion endpoint with SCRIPT dispatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [model, messages]
              properties:
                model:
                  type: string
                messages:
                  type: array
                  items:
                    type: object
      responses:
        '200':
          description: Response varies based on model
          content:
            application/json:
              schema:
                type: object
              examples:
                success_response:
                  summary: Response for straight mode
                  value:
                    id: "chatcmpl-001"
                    object: "chat.completion"
                    created: 1677652288
                    model: "gpt-3.5-turbo"
                    choices:
                      - index: 0
                        message:
                          role: "assistant"
                          content: "Microcks says: Max Verstappen won the 2024 British GP."
                        finish_reason: "stop"
                    usage:
                      prompt_tokens: 12
                      completion_tokens: 20
                      total_tokens: 32
                hallucinated_response:
                  summary: Response for hallucinate mode
                  value:
                    id: "chatcmpl-002"
                    object: "chat.completion"
                    created: 1677652290
                    model: "hallucinate"
                    choices:
                      - index: 0
                        message:
                          role: "assistant"
                          content: "Microcks says: Charles Leclerc won the 2024 British GP."
                        finish_reason: "stop"
                    usage:
                      prompt_tokens: 12
                      completion_tokens: 20
                      total_tokens: 32
